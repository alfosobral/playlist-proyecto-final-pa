<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Playlist Proyecto Final PA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
          background: linear-gradient(135deg, #0b0b0b, #121212);
          color: #e4e4e4;
          font-family: 'Poppins', sans-serif;
        }

        /* Navbar */
        .navbar {
          background: rgba(18,18,18,0.9);
          border-bottom: 1px solid #00f2ff30;
          box-shadow: 0 0 15px #00f2ff40;
        }
        .navbar-brand {
          color: #00f2ff !important;
          font-weight: 600;
          letter-spacing: 1px;
          transition: 0.3s;
        }
        .navbar-brand:hover {
          color: #fff !important;
          text-shadow: 0 0 10px #00f2ff;
        }

        /* Formulario */
        .add-card {
          background: rgba(255,255,255,0.05);
          border: 1px solid #00f2ff20;
          border-radius: 15px;
          padding: 1.5rem;
          backdrop-filter: blur(5px);
          box-shadow: 0 0 15px #00f2ff15;
        }

        ::placeholder {
          color: #77faff;            /* azul cian claro */
          opacity: 0.9;
        }

        ::-webkit-input-placeholder {
          color: #aaa;
        }
        :-ms-input-placeholder {
          color: #aaa;
        }
        ::-ms-input-placeholder {
          color: #aaa;
        }

        input.form-control {
          background-color: #1f1f1f;
          color: #e4e4e4;
          border: none;
        }
        input.form-control:focus {
          box-shadow: 0 0 10px #00f2ff90;
        }

        .btn-primary {
          background-color: #00f2ff;
          border: none;
          color: #000;
          font-weight: 600;
          transition: 0.2s;
        }
        .btn-primary:hover {
          background-color: #00c2cc;
          box-shadow: 0 0 15px #00f2ff;
        }

        /* Cards */
        .video-card {
          background: rgba(255,255,255,0.05);
          border: 1px solid #00f2ff15;
          border-radius: 15px;
          overflow: hidden;
          transition: transform 0.3s, box-shadow 0.3s;
          box-shadow: 0 0 20px #00000050;
          animation: fadeInUp 0.6s ease;
        }
        .video-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 0 25px #00f2ff30;
        }
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        iframe {
          border-radius: 10px;
        }

        .btn-outline-success, .btn-outline-warning, .btn-danger {
          border: none;
          font-weight: 600;
          transition: 0.2s;
        }

        .btn-outline-success:hover {
          background: #00f2ff;
          color: #000;
        }

        .btn-outline-warning:hover {
          background: #ffc107;
          color: #000;
        }

        .btn-danger:hover {
          background: #ff003c;
          box-shadow: 0 0 10px #ff003c80;
        }

        .fav-icon {
          font-size: 1.2rem;
          transition: 0.3s;
        }
        .fav-icon.active {
          color: #ffc107;
          text-shadow: 0 0 10px #ffc10790;
        }
        .fav-icon:hover {
          transform: scale(1.2);
        }

        /* Animaciones */
        @keyframes pulse-like {
          0% { transform: scale(1); }
          50% { transform: scale(1.4); text-shadow: 0 0 10px #00f2ff; }
          100% { transform: scale(1); }
        }
        @keyframes sparkle-fav {
          0% { transform: rotate(0deg) scale(1); color: #ffc107; text-shadow: 0 0 10px #ffc107; }
          25% { transform: rotate(15deg) scale(1.3); }
          50% { transform: rotate(-15deg) scale(1.3); }
          100% { transform: rotate(0deg) scale(1); color: #ffc107; }
        }
        .like-animate { animation: pulse-like 0.4s ease; }
        .fav-icon.animate { animation: sparkle-fav 0.5s ease; }
    </style>
</head>

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg mb-4 px-3">
    <a class="navbar-brand" href="/">üéß Playlist Proyecto Final PA</a>
</nav>

<div class="container">

    <!-- Formulario -->
    <div class="add-card mb-5">
        <form action="/add" method="post" class="row g-2">
            <div class="col-md-5">
                <input class="form-control" type="text" name="title" placeholder="T√≠tulo del video" required>
            </div>
            <div class="col-md-5">
                <input class="form-control" type="text" name="url" placeholder="URL de YouTube" required>
            </div>
            <div class="col-md-2 d-grid">
                <button class="btn btn-primary" type="submit">Agregar</button>
            </div>
        </form>
    </div>

    <!-- Favoritos -->
    <div th:if="${!#lists.isEmpty(videos)}" class="mb-5">
        <h4 class="text-info mb-4">‚≠ê Tus Favoritos</h4>
        <div class="row">
            <div class="col-md-4 mb-4" th:each="v : ${videos}" th:if="${v.fav}">
                <div class="video-card p-3 border border-info">
                    <h5 th:text="${v.title}" class="mb-3 text-info"></h5>
                    <iframe width="100%" height="200" th:src="${v.url}" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista vac√≠a -->
    <div th:if="${#lists.isEmpty(videos)}" class="text-center mt-5">
        <h5 class="text-muted">No hay videos todav√≠a... üé¨</h5>
    </div>

    <!-- Cards -->
    <div class="row" th:if="${!#lists.isEmpty(videos)}">
        <div class="col-md-4 mb-4" th:each="v : ${videos}">
            <div class="video-card p-3 h-100">
                <h5 th:text="${v.title}" class="mb-3"></h5>
                <iframe width="100%" height="200" th:src="${v.url}" frameborder="0" allowfullscreen></iframe>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                        <!-- LIKE -->
                        <th:button class="btn btn-outline-success btn-sm me-2"
                                   th:onclick="'likeOnce(event,' + ${v.id} + ', this)'">
                            üëç <span th:text="${v.likes}"></span>
                        </th:button>



                        <!-- FAV -->
                        <button class="btn btn-outline-warning btn-sm"
                                th:attr="data-id=${v.id}, data-fav=${v.fav}"
                                onclick="toggleFav(event, this)">
                            <span class="fav-icon" th:classappend="${v.fav} ? 'active' : ''">‚≠ê</span>
                        </button>
                    </div>
                    <a th:href="@{'/delete/' + ${v.id}}" class="btn btn-danger btn-sm">üóë</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function likeOnce(event, id, button) {
      event.preventDefault();
      const key = "liked_" + id;
      if (localStorage.getItem(key)) {
        alert("Ya le diste like a este video");
        return;
      }
      localStorage.setItem(key, true);

      fetch(`/like/${id}`, { method: "GET" })
        .then(res => res.text())
        .then(count => {
          const span = button.querySelector("span");
          span.textContent = count;
          button.classList.add("btn-success", "like-animate");
          button.classList.remove("btn-outline-success");
          setTimeout(() => button.classList.remove("like-animate"), 400);
        })
        .catch(err => console.error("Error al dar like:", err));
    }

    function toggleFav(event, button) {
      event.preventDefault();
      const id = button.getAttribute("data-id");

      fetch(`/fav/${id}`, { method: "GET" })
        .then(() => {
          const icon = button.querySelector(".fav-icon");
          icon.classList.toggle("active");
          icon.classList.add("animate");
          setTimeout(() => icon.classList.remove("animate"), 500);
        })
        .catch(err => console.error("Error al marcar favorito:", err));
    }
</script>
</body>
</html>
